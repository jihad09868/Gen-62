<!-- Logic: New Chat vs Active Chat -->

@if (isNewChat()) {
  <!-- CENTER LAYOUT -->
  <div class="flex flex-col items-center justify-center h-full w-full px-5 pb-20 fade-in-fast relative z-0">
      
      <h2 class="text-[42px] font-wet text-black dark:text-white tracking-widest mb-10 opacity-90 animate-fade-up select-none">Gen-62</h2>

      <!-- Center Input Box -->
      <div class="w-full max-w-[600px] relative animate-fade-up flex items-end gap-3" style="animation-delay: 0.1s;">
          
          <!-- Separate Voice Circle (Left) -->
          <button class="w-[42px] h-[42px] rounded-full bg-zinc-100 dark:bg-[#2f2f2f] hover:bg-zinc-200 dark:hover:bg-[#3f3f3f] flex items-center justify-center transition-colors shadow-sm shrink-0 mb-0.5 border border-zinc-200 dark:border-white/5">
             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-black dark:text-white"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
          </button>

          <!-- Main Input Pill (Input + Submit) -->
          <div class="relative flex-1 bg-zinc-100 dark:bg-[#2f2f2f] rounded-[26px] flex items-center p-1.5 transition-all shadow-sm border border-zinc-200 dark:border-white/5">
             
             <!-- Text Input -->
             <textarea 
                [ngModel]="inputMessage()"
                (ngModelChange)="inputMessage.set($event)"
                (keydown.enter)="handleKeydown($event)"
                class="w-full bg-transparent text-black dark:text-white text-[15px] px-3 py-1.5 focus:outline-none placeholder-zinc-500 resize-none no-scrollbar h-auto max-h-[150px] pr-[44px]"
                placeholder="Message Gen-62..."
                rows="1"
             ></textarea>

             <!-- Submit Button (Centered Vertically) -->
             <div class="absolute right-1.5 top-1/2 -translate-y-1/2">
                 <button 
                    (click)="handleAction()"
                    [disabled]="!inputMessage() && !isGenerating()"
                    class="w-8 h-8 rounded-full flex items-center justify-center transition-all bg-black dark:bg-white disabled:bg-zinc-300 dark:disabled:bg-[#444] disabled:text-zinc-500 text-white dark:text-black hover:scale-105 shadow-sm"
                 >
                    @if (isGenerating()) {
                       <div class="animate-spin rounded-full h-4 w-4 border-2 border-current border-t-transparent"></div>
                    } @else {
                       <svg stroke="currentColor" fill="none" stroke-width="2.5" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                    }
                 </button>
             </div>
          </div>
      </div>
  </div>
} @else {
  <!-- ACTIVE CHAT LAYOUT -->
  <div class="flex flex-col h-full w-full relative">
      
      <!-- Messages List -->
      <div 
        class="flex-1 overflow-y-auto w-full no-scrollbar pt-2 px-4 pb-4 scroll-smooth" 
        #scrollContainer
        (scroll)="onScroll()"
      >
          <div class="max-w-3xl mx-auto flex flex-col gap-6">
              
              @for (msg of messages(); track msg.id) {
                <div 
                    class="flex w-full flex-col group"
                    [class.items-end]="msg.role === 'user'"
                    [class.items-start]="msg.role !== 'user'"
                >
                    <!-- Message Content -->
                    <div 
                        class="max-w-full md:max-w-[90%] rounded-2xl relative"
                        [class.bg-[#f4f4f5]]="msg.role === 'user' && !ollamaService.isDarkMode()"
                        [class.bg-[#2f2f2f]]="msg.role === 'user' && ollamaService.isDarkMode()"
                        [class.text-black]="msg.role === 'user' && !ollamaService.isDarkMode()"
                        [class.text-white]="msg.role === 'user' && ollamaService.isDarkMode()"
                        [class.rounded-br-sm]="msg.role === 'user'"
                        
                        [class.bg-transparent]="msg.role !== 'user'"
                        [class.text-gray-900]="msg.role !== 'user' && !ollamaService.isDarkMode()"
                        [class.text-gray-100]="msg.role !== 'user' && ollamaService.isDarkMode()"
                        [class.pl-0]="msg.role !== 'user'" 
                    >
                        @if (editingMessageId() === msg.id) {
                            <!-- Edit Mode -->
                            <div class="w-full bg-[#1A1A1A] p-3 rounded-xl border border-white/20">
                                <textarea 
                                    [ngModel]="editContent()" 
                                    (ngModelChange)="editContent.set($event)"
                                    class="w-full bg-transparent text-white text-[15px] focus:outline-none resize-none no-scrollbar min-h-[80px]"
                                    rows="3"
                                ></textarea>
                                <div class="flex justify-end gap-2 mt-2">
                                    <button (click)="cancelEdit()" class="px-3 py-1.5 text-xs bg-zinc-800 hover:bg-zinc-700 rounded-lg text-white transition-colors">Cancel</button>
                                    <button (click)="saveEdit($index)" class="px-3 py-1.5 text-xs bg-white text-black font-semibold rounded-lg hover:bg-gray-200 transition-colors">Save & Submit</button>
                                </div>
                            </div>
                        } @else {
                            <!-- Advanced Content Render -->
                             <div class="text-[15px] leading-7 font-normal" [class.px-4]="msg.role === 'user'" [class.py-3]="msg.role === 'user'">
                                
                                @if (msg.role === 'user') {
                                   <!-- Simple Text for User (Just parse newlines) -->
                                   <div class="whitespace-pre-wrap">{{ msg.content }}</div>
                                } @else {
                                   <!-- Rich AI Response -->
                                   @for (part of parseMessageContent(msg.displayedContent || msg.content); track $index) {
                                      
                                      <!-- TEXT BLOCK -->
                                      @if (part.type === 'text') {
                                         <div class="whitespace-pre-wrap" [innerHTML]="linkify(part.content)"></div>
                                      }

                                      <!-- CODE EDITOR BLOCK -->
                                      @if (part.type === 'code') {
                                          <div class="my-4 rounded-lg overflow-hidden border border-zinc-300 dark:border-white/10 shadow-sm bg-[#1e1e1e] text-white">
                                              <!-- Editor Header -->
                                              <div class="flex items-center justify-between px-3 py-2 bg-[#2d2d2d] border-b border-white/5">
                                                  <span class="text-xs font-mono text-zinc-400 lowercase">{{ part.language }}</span>
                                                  <div class="flex items-center gap-2">
                                                      <!-- Play (Live Preview) -->
                                                      <button (click)="previewCode(part.content, part.language || '')" class="flex items-center gap-1.5 text-[11px] text-green-400 hover:text-green-300 px-2 py-1 hover:bg-white/5 rounded transition-colors">
                                                          <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="h-3 w-3"><path d="M8 5v14l11-7z"></path></svg>
                                                          Play
                                                      </button>

                                                      <!-- Edit Code -->
                                                      <button (click)="toggleCodeEdit(part)" class="flex items-center gap-1.5 text-[11px] text-zinc-400 hover:text-white px-2 py-1 hover:bg-white/5 rounded transition-colors">
                                                          <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                                          {{ part.isEditing ? 'Done' : 'Edit' }}
                                                      </button>

                                                      <!-- Copy Code -->
                                                      <button (click)="copyCode(part.content, msg.id + $index)" class="flex items-center gap-1.5 text-[11px] text-zinc-400 hover:text-white px-2 py-1 hover:bg-white/5 rounded transition-colors">
                                                          @if (copiedCodeId() === (msg.id + $index)) {
                                                              <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3"><polyline points="20 6 9 17 4 12"></polyline></svg>
                                                          } @else {
                                                              <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                                          }
                                                          Copy
                                                      </button>

                                                      <!-- Download ZIP -->
                                                      <button (click)="downloadCode(part.content, part.language || 'txt')" class="flex items-center gap-1.5 text-[11px] text-zinc-400 hover:text-white px-2 py-1 hover:bg-white/5 rounded transition-colors">
                                                          <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                                          ZIP
                                                      </button>
                                                  </div>
                                              </div>
                                              <!-- Editor Body -->
                                              <div class="relative group">
                                                  @if (part.isEditing) {
                                                      <textarea 
                                                          [(ngModel)]="part.codeVal" 
                                                          class="w-full bg-[#1e1e1e] text-zinc-300 font-mono text-[13px] p-4 focus:outline-none min-h-[150px] resize-y code-scroll"
                                                          spellcheck="false"
                                                      ></textarea>
                                                  } @else {
                                                      <div class="p-4 overflow-x-auto code-scroll">
                                                          <pre class="font-mono text-[13px] text-zinc-300 whitespace-pre">{{ part.content }}</pre>
                                                      </div>
                                                  }
                                              </div>
                                          </div>
                                      }

                                      <!-- YOUTUBE BLOCK -->
                                      @if (part.type === 'youtube') {
                                          <div class="my-4 rounded-xl overflow-hidden shadow-lg border border-black/10 dark:border-white/10 bg-black">
                                              <iframe 
                                                  [src]="part.safeUrl" 
                                                  width="100%" 
                                                  height="320" 
                                                  frameborder="0" 
                                                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                                  allowfullscreen>
                                              </iframe>
                                              <div class="p-3 bg-zinc-900 text-white flex items-center gap-2 text-xs">
                                                  <svg stroke="currentColor" fill="red" stroke-width="0" viewBox="0 0 1024 1024" class="h-4 w-4"><path d="M941.3 296.1a112.3 112.3 0 0 0-79.2-79.3C792.2 198 512 198 512 198s-280.2 0-350.1 18.7A112.12 112.12 0 0 0 82.7 296C64 366 64 512 64 512s0 146 18.7 215.9c10.3 38.6 40.7 69 79.2 79.3C231.8 826 512 826 512 826s280.2 0 350.1-18.7c38.6-10.3 68.9-40.7 79.2-79.3C960 658 960 512 960 512s0-146-18.7-215.9zM423 646V378l232 133-232 135z"></path></svg>
                                                  YouTube Preview
                                              </div>
                                          </div>
                                      }

                                       <!-- PROMPT BLOCK -->
                                      @if (part.type === 'prompt') {
                                           <div class="my-4 bg-zinc-100 dark:bg-white/5 border-l-4 border-purple-500 p-4 rounded-r-lg">
                                              <div class="text-[11px] font-bold text-purple-600 dark:text-purple-400 uppercase tracking-wide mb-1">Suggested Prompt</div>
                                              <div class="text-sm italic text-zinc-700 dark:text-zinc-300 font-mono">{{ part.content }}</div>
                                              <button (click)="copyToClipboard(part.content, msg.id + 'p')" class="mt-2 text-xs text-zinc-500 hover:text-black dark:hover:text-white flex items-center gap-1">
                                                  <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                                  Copy Prompt
                                              </button>
                                           </div>
                                      }

                                   }
                                }
                             </div>
                        }
                    </div>

                    <!-- User Actions Row -->
                    @if (msg.role === 'user' && editingMessageId() !== msg.id) {
                        <div class="flex items-center gap-2 mt-1 mr-1 select-none transition-opacity duration-300 opacity-100 md:opacity-0 md:group-hover:opacity-100">
                            <!-- Edit -->
                            <button (click)="startEdit(msg)" class="p-1.5 text-zinc-500 hover:text-black dark:hover:text-white rounded hover:bg-black/5 dark:hover:bg-white/10" title="Edit">
                                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-3.5 w-3.5"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                            </button>

                            <!-- Copy -->
                            <button (click)="copyToClipboard(msg.content, msg.id)" class="p-1.5 text-zinc-500 hover:text-black dark:hover:text-white rounded hover:bg-black/5 dark:hover:bg-white/10" title="Copy">
                                @if (copiedMessageId() === msg.id) {
                                    <div class="animate-check-pop flex items-center justify-center w-3.5 h-3.5 rounded-full border border-black dark:border-white">
                                        <svg stroke="currentColor" fill="none" stroke-width="3" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-2 w-2 text-black dark:text-white"><polyline points="20 6 9 17 4 12"></polyline></svg>
                                    </div>
                                } @else {
                                    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-3.5 w-3.5"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                }
                            </button>
                        </div>
                    }

                    <!-- AI Action Bar -->
                    @if (msg.role === 'assistant' && (!msg.isTyping || !isGenerating())) {
                        <div class="flex items-center gap-2 mt-2 ml-1 transition-opacity duration-300 opacity-100 md:opacity-0 md:group-hover:opacity-100">

                            <!-- Copy -->
                            <button (click)="copyToClipboard(msg.content, msg.id)" class="p-1.5 text-zinc-500 hover:text-black dark:hover:text-white rounded hover:bg-black/5 dark:hover:bg-white/10 relative transition-colors" title="Copy">
                                @if (copiedMessageId() === msg.id) {
                                    <div class="animate-check-pop flex items-center justify-center w-4 h-4 rounded-full border border-black dark:border-white">
                                        <svg stroke="currentColor" fill="none" stroke-width="3" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-2.5 w-2.5 text-black dark:text-white"><polyline points="20 6 9 17 4 12"></polyline></svg>
                                    </div>
                                } @else {
                                    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                }
                            </button>
                            
                            <!-- Audio (Opens Player) -->
                            <button (click)="prepareAudio(msg.content)" class="p-1.5 text-zinc-500 hover:text-black dark:hover:text-white rounded hover:bg-black/5 dark:hover:bg-white/10 transition-colors" title="Read Aloud">
                                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                            </button>

                            <!-- Like -->
                            <button (click)="toggleLike(msg, $index)" class="p-1.5 rounded hover:bg-black/5 dark:hover:bg-white/10 transition-colors active:scale-125 transition-transform duration-200" 
                                [class.text-zinc-500]="!msg.liked" 
                                [class.text-black]="msg.liked && !ollamaService.isDarkMode()" 
                                [class.text-white]="msg.liked && ollamaService.isDarkMode()" 
                                [class.bg-black-10]="msg.liked && !ollamaService.isDarkMode()"
                                [class.bg-white-10]="msg.liked && ollamaService.isDarkMode()"
                                title="Good Response">
                                <svg stroke="currentColor" [attr.fill]="msg.liked ? 'currentColor' : 'none'" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" [class.animate-like-pop]="msg.liked"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>
                            </button>
                            
                            <!-- Dislike -->
                            <button (click)="toggleDislike(msg, $index)" class="p-1.5 rounded hover:bg-black/5 dark:hover:bg-white/10 transition-colors active:scale-125"
                                [class.text-zinc-500]="!msg.disliked" 
                                [class.text-black]="msg.disliked && !ollamaService.isDarkMode()"
                                [class.text-white]="msg.disliked && ollamaService.isDarkMode()"
                                [class.bg-black-10]="msg.disliked && !ollamaService.isDarkMode()"
                                [class.bg-white-10]="msg.disliked && ollamaService.isDarkMode()"
                                title="Bad Response">
                                <svg stroke="currentColor" [attr.fill]="msg.disliked ? 'currentColor' : 'none'" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4" [class.animate-like-pop]="msg.disliked"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg>
                            </button>

                            <!-- PDF Download -->
                            <button (click)="exportPdf(msg.content)" class="p-1.5 text-zinc-500 hover:text-black dark:hover:text-white rounded hover:bg-black/5 dark:hover:bg-white/10 transition-colors" title="Download PDF">
                                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            </button>
                        </div>
                    }
                </div>
              }
              
              <div class="h-32 w-full"></div>
          </div>
      </div>

      <!-- Bottom Input Area -->
      <div class="w-full px-4 pb-6 pt-2 animate-slide-up-fade z-20 relative">
          
          <!-- Compact Pill Audio Player -->
          @if (isAudioVisible()) {
            <div 
                class="absolute -top-[60px] left-0 right-0 mx-auto w-full max-w-[500px] z-30"
                [class.animate-message-slide]="!isAudioClosing()"
                [class.animate-message-delete]="isAudioClosing()"
            >
                <div class="bg-white dark:bg-[#2f2f2f] rounded-full px-2 py-1.5 flex items-center gap-3 shadow-xl border border-zinc-200 dark:border-white/5 mx-4 h-[48px] relative">
                    
                    <!-- Play/Pause Button -->
                    <button (click)="toggleAudioPlay()" class="w-9 h-9 rounded-full bg-black dark:bg-white flex items-center justify-center shrink-0 hover:scale-105 transition-transform text-white dark:text-black shadow-lg">
                        @if (isAudioPlaying()) {
                             <!-- Pause Bars Icon -->
                             <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="h-4 w-4"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
                        } @else {
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="h-4 w-4 ml-0.5"><path d="M8 5v14l11-7z"></path></svg>
                        }
                    </button>

                    <!-- Scrubber Slider -->
                    <div class="flex-1 flex items-center h-full pt-1">
                        <input 
                            type="range" 
                            min="0" 
                            max="100" 
                            [value]="audioProgress()"
                            (input)="seekAudioInput($event)"
                            (change)="seekAudioChange($event)"
                            (touchend)="seekAudioChange($event)"
                            class="w-full h-1 bg-zinc-200 dark:bg-zinc-600 rounded-full appearance-none cursor-pointer"
                            [style.background]="'linear-gradient(to right, ' + (ollamaService.isDarkMode() ? 'white' : 'black') + ' ' + audioProgress() + '%, ' + (ollamaService.isDarkMode() ? '#52525b' : '#e4e4e7') + ' ' + audioProgress() + '%)'"
                        />
                    </div>

                    <!-- Time Display (Current / Total) -->
                    <div class="text-[11px] font-mono text-zinc-600 dark:text-white font-medium min-w-[60px] text-right flex items-center gap-1 justify-end pr-2">
                         <span>{{ formatTimeSimple(audioSeconds()) }} / {{ formatTimeSimple(audioTotalSeconds()) }}</span>
                    </div>

                    <!-- Close X -->
                    <button (click)="closeAudio()" class="w-8 h-8 rounded-full flex items-center justify-center text-zinc-500 hover:text-black dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
                        <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
            </div>
          }

          <div class="max-w-3xl mx-auto relative flex items-end gap-3">
              
             <!-- Separate Voice Circle -->
             <button 
                class="w-[38px] h-[38px] rounded-full flex items-center justify-center transition-colors shadow-sm bg-zinc-100 dark:bg-[#2f2f2f] hover:bg-zinc-200 dark:hover:bg-[#3f3f3f] text-black dark:text-white mb-[3px] shrink-0 border border-zinc-200 dark:border-white/5"
             >
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
             </button>

             <!-- Main Pill Input (Slim) -->
             <div class="relative flex-1 bg-zinc-100 dark:bg-[#2f2f2f] rounded-[26px] flex items-center p-1.5 transition-all shadow-sm border border-zinc-200 dark:border-white/5">
                 
                 <textarea 
                    #bottomTextarea
                    [ngModel]="inputMessage()"
                    (ngModelChange)="inputMessage.set($event)"
                    (input)="autoResize($event)"
                    (keydown)="handleKeydown($event)"
                    class="w-full bg-transparent text-black dark:text-white text-[15px] px-3 py-2 focus:outline-none placeholder-zinc-500 no-scrollbar resize-none z-10 relative leading-6 pr-[44px]"
                    style="min-height: 40px; max-height: 160px;"
                    placeholder="Message Gen-62..."
                    rows="1"
                 ></textarea>

                 <!-- Submit Button (Centered Vertically) -->
                 <div class="absolute right-1.5 top-1/2 -translate-y-1/2 z-20">
                     <button 
                       (click)="handleAction()"
                       [disabled]="!inputMessage() && !isGenerating()"
                       class="w-8 h-8 rounded-full flex items-center justify-center transition-all bg-black dark:bg-white text-white dark:text-black disabled:bg-zinc-300 dark:disabled:bg-[#444] disabled:text-zinc-500 hover:scale-105 shadow-sm"
                     >
                        @if (isGenerating()) {
                            <div class="animate-spin rounded-full h-4 w-4 border-[2px] border-current border-t-transparent"></div>
                        } @else {
                            <svg stroke="currentColor" fill="none" stroke-width="2.5" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 ml-0.5"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                        }
                     </button>
                 </div>
              </div>

          </div>
      </div>
  </div>
}

<style>
  .fade-in-fast { animation: fadeIn 0.8s ease-out forwards; }
  .animate-fade-up { animation: fadeUp 0.8s ease-out forwards; opacity: 0; }
  .animate-slide-up-fade { animation: slideUpFade 0.7s cubic-bezier(0.16, 1, 0.3, 1) forwards; transform-origin: bottom; }
  
  @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes slideUpFade { 0% { opacity: 0; transform: translateY(40px); } 100% { opacity: 1; transform: translateY(0); } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>